<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-11-17
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20141117" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Trap Java API - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>TrAP API</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-11-17</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.3.0-SNAPSHOT</li>
                          <li class="divider">|</li>             <li class="">
                    <a href="../index.html" title="Trap">
        Trap</a>
        </li>
      <li class="divider ">/</li>
                <li class="">
                    <a href="./" title="Trap Java API">
        Trap Java API</a>
        </li>
      <li class="divider ">/</li>
        <li class=""></li>
                
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Trap 1.3.0-SNAPSHOT</li>
                                
      <li>
    
                          <a href="../index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li>
    
                          <a href="../trap-api/quickstart.html" title="Java Quickstart">
          <i class="none"></i>
        Java Quickstart</a>
            </li>
                  
      <li>
    
                          <a href="../trap-js/index.html" title="JavaScript Quickstart">
          <i class="none"></i>
        JavaScript Quickstart</a>
            </li>
                  
      <li>
    
                          <a href="../channels.html" title="Channels">
          <i class="none"></i>
        Channels</a>
            </li>
                  
      <li>
    
                          <a href="../configuration.html" title="Configuration">
          <i class="none"></i>
        Configuration</a>
            </li>
                              <li class="nav-header">Language Specific Documentation</li>
                                
      <li>
    
                          <a href="../trap-api/index.html" title="Java">
          <i class="none"></i>
        Java</a>
            </li>
                  
      <li>
    
                          <a href="../trap-js/index.html" title="JavaScript">
          <i class="none"></i>
        JavaScript</a>
            </li>
                              <li class="nav-header">Trap Java API</li>
                                
      <li>
    
                          <a href="index.html" title="About">
          <i class="none"></i>
        About</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Quickstart</a>
          </li>
                  
      <li>
    
                          <a href="delegates.html" title="Delegate Model">
          <i class="none"></i>
        Delegate Model</a>
            </li>
                  
      <li>
    
                          <a href="model.html" title="Threading Model">
          <i class="none"></i>
        Threading Model</a>
            </li>
                  
      <li>
    
                          <a href="apidocs/index.html" title="Javadoc">
          <i class="none"></i>
        Javadoc</a>
            </li>
                                        <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                                              
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                            
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="ericssonresearch.github.io/trap/trap-api/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Trap Quickstart (Java)</h1>
<p>In general, Trap attempts to expose an asynchronous socket API. The basic operations (and the ones covered in this document) are:</p>

<ul>
  
<li><i>Listen</i> for incoming connections</li>
  
<li><i>Accept</i> an incoming connection</li>
  
<li><i>Open</i> an outgoing connection</li>
  
<li><i>Send</i> data</li>
  
<li><i>Receive</i> data</li>
</ul>
<p>This document will exemplify how to do all of the above. In addition the API docs provide <a href="./apidocs">full examples</a> on how to use Trap.</p>
<h1>Installation</h1>
<p>Add Trap to your project either as a fully-blown, self-contained archive, or piecemeal as Maven Artifacts. Trap depends on slf4j for its logging; if embedded, slf4j will be included.</p>
<div class="section">
<h2>Single Dependency Model<a name="Single_Dependency_Model"></a></h2>
<p>Trap provides a basic package that includes four transports in a single package. These four basic transports should work in most circumstances and serve as a starting point on using Trap. These can be included by adding the following Maven dependency</p>

<div class="source">
<pre>    &lt;dependency&gt;
       &lt;groupId&gt;com.ericsson.research.trap.packaging&lt;/groupId&gt;
       &lt;artifactId&gt;trap-full&lt;/artifactId&gt;
       &lt;version&gt;${project.version}&lt;/version&gt;
    &lt;/dependency&gt;
</pre></div></div>
<div class="section">
<h2>Selective Transport Model<a name="Selective_Transport_Model"></a></h2>
<p>The other way to include Trap is to explicitly select which transports to use. All transports depend on the Trap API, so it will be included by default in any dependency. See the <a href="../trap-transports">Trap Transports</a> project for a list of the current Trap transports and their options. </p>
<h1>Listening for Incoming Connections</h1>
<p>The first step in having a connection is opening a socket for listening. In Trap, this is done by creating a Trap listener. For this full example, see the <a href="./apidocs/reference/com/ericsson/research/trap/examples/ConfiguredServer.html">ConfiguredServer example</a>.</p>

<div class="source">
<pre>    // Create a new listener
    listener = TrapFactory.createListener();

    // At this point, we might want to configure it. For now, we'll go with default config.

    // Start the server.
    // The listener will retain a reference to our delegate (the TrapEchoServer object).
    listener.listen(new EchoServer());
</pre></div>
<p>This will start a Trap listener on any available port. To specify some ports, configure the Trap Listener to assign ports to each transport.</p>

<div class="source">
<pre>    // Create a new listener
    listener = TrapFactory.createListener();

    // At this point, we might want to configure it. For now, we'll go with default config.
    listener.configureTransport(&quot;http&quot;, &quot;port&quot;, &quot;4000&quot;);
    listener.configureTransport(&quot;websocket&quot;, &quot;port&quot;, &quot;4001&quot;);
    listener.configureTransport(&quot;socket&quot;, &quot;port&quot;, &quot;4002&quot;);

    // Start the server.
    // The listener will retain a reference to our delegate (the TrapEchoServer object).
    listener.listen(new EchoServer());
</pre></div>
<p>With the above, we configure the ports of the above transports; however, they will bind to 0.0.0.0 and may not properly react to being NAT-ed.</p>
<p>As the caller, we must maintain a permanent reference to the <i>listener</i> object. Failure to do so will cause it to be garbage collected, and all resources released.</p>
<h1>Accepting an Incoming Connection</h1>
<p>When the TrapListener object detects an incoming connection, it will call the <a href="./apidocs/reference/com/ericsson/research/trap/delegates/OnAccept.html">OnAccept</a> interface on the object provided to the <i>listen()</i> method. In this case, our EchoServer class implements it.</p>

<div class="source">
<pre>public void incomingTrapConnection(TrapEndpoint endpoint, TrapListener listener, Object context)
{
    // Endpoints received by this method are NOT strongly referenced, and may be GC'd. Thus, we must retain
    clients.add(endpoint);

    // We also want feedback from the endpoint.
    endpoint.setDelegate(this, true);
}
</pre></div>
<p>The first line stores the new connection (TrapEndpoint) in a set, to prevent it from being garbage collected. Like the listener, if the endpoint object becomes garbage collected, the connection is closed automatically. The second line sets the <i>delegate</i> object to receive callbacks from the endpoint. See <a href="./delegates.html">Delegates</a> for more description on delegates.</p>
<h1>Opening an Outgoing Connection</h1>
<p>Once we have a listener, we are able to connect to it. For this full example, see the <a href="./apidocs/reference/com/ericsson/research/trap/examples/ConfiguredClient.html">ConfiguredClient example</a>.</p>

<div class="source">
<pre>// Create a new Trap Client to the specified host.
// The second parameter of true tells the client to attempt to autodiscover other transports.
// If it was set to false, the client can only ever use the manually configured transports.
this.client = TrapFactory.createClient(&quot;http://trap.example.com:4000&quot;, true);

// Tell the client to use us as a delegate.
this.client.setDelegate(this, true);

// Start connecting.
this.client.open();
</pre></div>
<p>There is at least one delegate method that needs to be implemented by the client for this to work properly, and that is OnOpen. That delegate will be called when the connection has been opened.</p>

<div class="source">
<pre>// Called when the client is open (=ready to send)
public void trapOpen(TrapEndpoint endpoint, Object context)
{
    try
    {
        // Send some bytes
        this.client.send(new byte[65535], 1, true);
    }
    catch (TrapException e)
    {
        // TODO Auto-generated catch block
        e.printStackTrace();
    }
}
</pre></div>
<h1>Sending Data</h1>
<p>As shown above, data is sent by using the <i>send()</i> method. The data will be serialised and sent to the other side. Trap includes built-in deflate compression. It can be enabled and disabled on a per-message basis, and is activated by the third parameter of the send method. The second argument is the Channel ID to send on. See the APIdocs for <a href="./apidocs/reference/com/ericsson/research/trap/TrapChannel.html">TrapChannel</a>.</p>
<h1>Receiving Data</h1>
<p>When an endpoint receives data, it will call the OnData or OnObject delegate, as applicable. OnData will only be called if an object that implements the TrapObject interface was provided to send. Otherwise, OnData will be called as follows</p>

<div class="source">
<pre>// Called when the client receives data. Since we connect to the echo server, the same message should come back.
public void trapData(byte[] data, int channel, TrapEndpoint endpoint, Object context)
{
    System.out.println(&quot;Got message: &quot; + StringUtil.toUtfString(data));
    this.sendMessage();
}
</pre></div>
<h1>Next Steps</h1>
<p>The above functionality provides the basics of Trap. The next topics are:</p>

<ul>
  
<li>The <a href="./delegates.html">Delegate Model</a> for how to handle errors and other events.</li>
  
<li>The <a href="../channels.html">Channel Model</a> for how Trap multiplexing works.</li>
  
<li>The <a href="../configuration.html">Configuration Model</a> on how Trap is configured.</li>
</ul></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2014
                        <a href="https://www.ericsson.com">Ericsson AB</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>